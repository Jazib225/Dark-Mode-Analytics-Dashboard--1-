<!DOCTYPE html>
<html>
<head>
  <title>Wallet Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #1a1a1a; color: white; }
    button { padding: 15px 30px; margin: 10px; font-size: 16px; cursor: pointer; border: none; border-radius: 8px; }
    .metamask { background: #f6851b; }
    .phantom { background: #ab9ff2; }
    #result { margin-top: 20px; padding: 15px; background: #333; border-radius: 8px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>Wallet Connection Test</h1>
  
  <div>
    <button class="metamask" onclick="testMetaMask()">Test MetaMask</button>
    <button class="phantom" onclick="testPhantom()">Test Phantom</button>
    <button style="background:#666" onclick="clear()">Clear</button>
  </div>
  
  <div id="result">Click a button to test...</div>
  
  <script>
    function log(msg) {
      document.getElementById('result').textContent += msg + '\n';
      console.log(msg);
    }
    
    function clear() {
      document.getElementById('result').textContent = '';
    }
    
    async function testMetaMask() {
      clear();
      log('Testing MetaMask...');
      log('window.ethereum exists: ' + !!window.ethereum);
      
      if (window.ethereum) {
        log('isMetaMask: ' + window.ethereum.isMetaMask);
        log('providers: ' + JSON.stringify(window.ethereum.providers?.map(p => ({ isMetaMask: p.isMetaMask, isPhantom: p.isPhantom }))));
        
        try {
          log('Requesting accounts...');
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          log('SUCCESS! Accounts: ' + JSON.stringify(accounts));
        } catch (err) {
          log('ERROR: ' + JSON.stringify({ code: err.code, message: err.message }));
        }
      } else {
        log('MetaMask not installed');
      }
    }
    
    async function testPhantom() {
      clear();
      log('=== PHANTOM CONNECTION TEST ===\n');
      
      // Step 1: Detection
      log('Step 1: Detecting Phantom...');
      log('  window.phantom exists: ' + !!window.phantom);
      log('  window.phantom.solana exists: ' + !!window.phantom?.solana);
      log('  window.phantom.solana.isPhantom: ' + !!window.phantom?.solana?.isPhantom);
      log('  window.solana exists: ' + !!window.solana);
      log('  window.solana.isPhantom: ' + !!window.solana?.isPhantom);
      
      // Get provider
      let provider = null;
      if (window.phantom?.solana?.isPhantom) {
        provider = window.phantom.solana;
        log('\n  Using: window.phantom.solana');
      } else if (window.solana?.isPhantom) {
        provider = window.solana;
        log('\n  Using: window.solana');
      }
      
      if (!provider) {
        log('\n❌ Phantom NOT DETECTED - Please install Phantom extension');
        return;
      }
      
      log('\n✅ Provider found!');
      log('  isPhantom: ' + provider.isPhantom);
      log('  isConnected: ' + provider.isConnected);
      
      // Step 2: Check existing connection
      log('\nStep 2: Checking existing connection...');
      if (provider.isConnected && provider.publicKey) {
        log('  Already connected!');
        log('  Public Key: ' + provider.publicKey.toString());
      } else {
        log('  Not connected yet');
      }
      
      // Step 3: Try connecting
      log('\nStep 3: Attempting connection...');
      
      // Try connect() method
      try {
        log('  Trying provider.connect()...');
        const resp = await provider.connect();
        log('  ✅ SUCCESS with connect()!');
        log('  Public Key: ' + resp.publicKey.toString());
        return;
      } catch (err) {
        log('  ❌ connect() failed: ' + JSON.stringify({ code: err.code, message: err.message, name: err.name }));
      }
      
      // Try request method
      try {
        log('\n  Trying provider.request({ method: "connect" })...');
        const resp = await provider.request({ method: 'connect' });
        log('  ✅ SUCCESS with request()!');
        log('  Public Key: ' + resp.publicKey.toString());
        return;
      } catch (err) {
        log('  ❌ request() failed: ' + JSON.stringify({ code: err.code, message: err.message, name: err.name }));
      }
      
      log('\n❌ All connection methods failed');
    }
  </script>
</body>
</html>
